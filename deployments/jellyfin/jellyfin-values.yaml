# jellyfin-values.yaml
# values for bjw-s/app-template
fullnameOverride: jellyfin

controllers:
  main:
    replicas: 1
    pod:
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
    containers:
      app:
        image:
          repository: jellyfin/jellyfin
          tag: "10.10.7"      # bump to 10.11.x later after you’re stable
          pullPolicy: IfNotPresent
        env:
          TZ: America/New_York
        resources:
          requests: { cpu: "200m", memory: "512Mi" }
          limits:   { cpu: "2",    memory: "4Gi" }

service:
  main:
    ports:
      http:
        port: 8096
      https:
        port: 8920
      discovery1:
        port: 1900
        protocol: UDP
      discovery2:
        port: 7359
        protocol: UDP


ingress:
  main:
    enabled: false  # you keep using Traefik IngressRoute CRDs

persistence:
  config:
    enabled: true
    size: 5Gi
    accessMode: ReadWriteOnce
    storageClass: ceph-fs-data-ec
    mountPath: /config

  cache:
    enabled: true
    size: 250Gi
    accessMode: ReadWriteOnce
    storageClass: ceph-fs-data-ec
    mountPath: /cache

  media:
    enabled: true
    existingClaim: jellyfin-media-ro   # from your static PV/PVC below
    readOnly: true
    mountPath: /media
    # If you’d like explicit subfolders like before, uncomment:
    # advancedMounts:
    #   main:
    #     app:
    #       - path: /videos
    #         subPath: data/HomeMedia/files/Videos
    #         readOnly: true
    #       - path: /music
    #         subPath: data/HomeMedia/files/Music
    #         readOnly: true

probes:
  liveness:  { enabled: true }
  readiness: { enabled: true }
  startup:   { enabled: true }
