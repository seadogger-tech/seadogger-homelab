fullnameOverride: jellyfin

controllers:
  main:
    replicas: 1
    pod:
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      annotations:
        backup.velero.io/backup-volumes-excludes: media
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        # Group 33 = www-data, Group 44 = video (for V4L2 hardware acceleration)
        supplementalGroups: [33, 44]
    containers:
      app:
        image:
          repository: jellyfin/jellyfin
          tag: "10.11.4"
          pullPolicy: IfNotPresent
        env:
          TZ: America/New_York
        resources:
          requests: { cpu: "200m", memory: "512Mi" }
          limits:   { cpu: "2",    memory: "4Gi" }
        securityContext:
          privileged: false
          allowPrivilegeEscalation: false

service:
  main:
    ports:
      http:
        port: 8096

ingress:
  main:
    enabled: false   # youâ€™re using Traefik IngressRoute separately

persistence:
  config:
    enabled: true
    size: 5Gi
    accessMode: ReadWriteOnce
    storageClass: ceph-fs-data-ec
    globalMounts:
      - path: /config

  cache:
    enabled: true
    size: 250Gi
    accessMode: ReadWriteOnce
    storageClass: ceph-fs-data-ec
    globalMounts:
      - path: /cache

  media:
    enabled: true
    existingClaim: jellyfin-media-ro
    globalMounts:
      - path: /media
        readOnly: true

  # V4L2 Hardware Acceleration - Mount entire /dev for video/media device autodiscovery
  # Jellyfin probes all /dev/video* and /dev/media* nodes and binds to correct encoders/decoders
  # Device numbers are dynamic and vary between boots, so mounting all devices is required
  dev:
    enabled: true
    type: hostPath
    hostPath: /dev
    globalMounts:
      - path: /dev
