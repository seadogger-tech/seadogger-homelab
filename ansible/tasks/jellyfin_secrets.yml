---
- name: Set KUBECONFIG global
  ansible.builtin.set_fact:
    KUBECONFIG: /etc/rancher/k3s/k3s.yaml
  tags: jellyfin

# Create HDHomeRun credentials secret for XMLTV proxy
- name: Create HDHomeRun credentials secret
  kubernetes.core.k8s:
    kubeconfig: "{{ KUBECONFIG }}"
    state: present
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: hdhomerun-credentials
        namespace: jellyfin
      type: Opaque
      stringData:
        email: "{{ hdhomerun_email }}"
        device-ids: "{{ hdhomerun_device_ids }}"
  tags: jellyfin
